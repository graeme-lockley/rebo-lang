let {any, filter, map, reduce, split} = import("std")

let add(v = "") {
  let tokens = 
    if v == "" -> 
        []
    | v[:3] == "//[" -> {
        let items = split(v[2:], "\n")
        let delimiters = items[0][1:len(items[0]) - 1] |> split("][")

        items[1] |> split(delimiters)
      }
    | v[:2] == "//" -> 
        v[2:] |> split(v[2])
    | v |> split([",", "\n"])

  let numbers =
    tokens |> map(int)

  if any(numbers, negative?) -> filter(numbers, negative?)
   | numbers |> sumSmallNumbers()
}

let negative?(n) = 
  n < 0

let sumSmallNumbers(ns) =
  ns |> filter(fn(n) n < 1000) |> reduce(fn(a, b) a + b, 0)
